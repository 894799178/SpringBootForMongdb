<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="/js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="/easyUI/1.5.5.4/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/easyUI/1.5.5.4/locale/easyui-lang-zh_CN.js"></script>
    <script src="https://code.highcharts.com/highcharts.src.js"></script>
	
    <title>Title</title>
</head>
<body>
    <div id="container" style="min-width:400px;height:400px"></div>
    <a id="atk"></a>
    <a id="hp"></a>
	<input type="text" id="input_text" />
    <button id="_btn" onclick="print()">2333</button>
    <script>
        var count = 0;
        var arrIsCrit = new Array();
        var totalDamage = 0;
		
        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });
        function activeLastPointToolip(chart) {
            var points = chart.series[0].points;
            chart.tooltip.refresh(points[points.length -1]);
        }
        var chart = Highcharts.chart('container', {
            chart: {
                type: 'spline',
                marginRight: 10,
                events: {
                    load: function () {
                        var series = this.series[0],
                            chart = this;
                        
                    }
                }
            },
            title: {
                text: '伤害监控'
            },
            xAxis: {
                tickPixelInterval: 50
            },
            yAxis: {
                title: {
                    text: null
                },
                minorTickLength: 10
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>第' +
                         this.x + '次<br/>伤害:' +
                        this.y+"-->"+arrIsCrit[this.x] ;
                }
            },
            legend: {
                enabled: false
            },
            series: [{
                name: '伤害监控',
                data: (function () {
                    // 生成随机值
					
                    var data = [];
                    for (var i= 1;i<1000;i++){
                        data.push({
                            x: 0,
                            y: i
                        });
                    }
				console.log(data);
                    return data;
                }())
            }]
        });
        function getData(){
            var result  = requestFormAjax("http://localhost:8080/getDamegeData",false);
            return result;
        }
        function print(){
			var typeId= $("#input_text").val()
			var item1 = chart.series[0];	
			$.ajax({
				url:"http://localhost:8080/getDamageDataByTypeId?typeId="+typeId,
				async:false,
				success:function(data){  
					//console.log(data);
					$.each(data,function(index,item){
						console.log(item.pointY)
						var x =  parseInt(item.pointX);
						var y = parseInt(item.pointY);
                        arrIsCrit[count++] = item.isCrit;
						item1.addPoint([x,y], false, true);
					})
                   // item1.redraw();
					//item1.reflow ();
                    item1.addPoint([count+1,0], true, true);
				}
			  });  
		
        }
        //页面加载完后,在加载js
        $(function (){
				
		
			console.log("2333333")
        });
      function requestFormAjax(url,async){
          var result;
          $.ajax({
              url:url,
              type:"post",
              async:async,
              success:function(data){
                  if( data != null && data != ""){
                      result =  eval('(' + data + ')');
                  }
              }
          })
          return result;
      }
    </script>
</body>
</html>